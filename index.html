<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ZERO KARMA : TANTRA ANALYZER</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+KR:wght@300;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-green: #00ff9d;
            --neon-blue: #00ccff;
            --neon-red: #ff0055;
            --neon-yellow: #ffcc00;
            --dark-bg: #050505;
            --glass: rgba(255, 255, 255, 0.05);
        }

        body {
            margin: 0;
            background-color: var(--dark-bg);
            color: #fff;
            font-family: 'Orbitron', 'Noto Sans KR', sans-serif;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* ë°°ê²½ íƒ„ì‚° ê¸°í¬ íš¨ê³¼ */
        .bubbles {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: 
                radial-gradient(circle at 50% 50%, rgba(0, 255, 157, 0.1) 0%, transparent 60%),
                repeating-linear-gradient(0deg, transparent, transparent 2px, #000 3px);
            pointer-events: none;
        }

        h1 {
            margin-top: 40px;
            font-size: 2.5rem;
            color: var(--neon-green);
            text-shadow: 0 0 10px var(--neon-green), 0 0 20px var(--neon-green);
            letter-spacing: 5px;
            text-align: center;
        }

        .subtitle {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 40px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        /* ë§Œë‹¤ë¼ ì—…ë¡œë“œ ì„¹ì…˜ */
        .mandala-container {
            position: relative;
            width: 300px;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 50px;
        }

        /* íšŒì „í•˜ëŠ” ë§ŒíŠ¸ë¼ ë§ */
        .mantra-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 1px dashed rgba(0, 255, 157, 0.3);
            animation: spin 20s linear infinite;
        }
        
        .mantra-text {
            position: absolute;
            width: 100%;
            height: 100%;
            text-align: center;
            font-size: 12px;
            color: var(--neon-green);
            opacity: 0.7;
        }

        /* ì¤‘ì•™ì˜ íƒ(TAM) ì¢…ìì & ì—…ë¡œë“œ ë²„íŠ¼ */
        .seed-syllable {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 2px solid var(--neon-green);
            box-shadow: 0 0 30px rgba(0, 255, 157, 0.2), inset 0 0 20px rgba(0, 255, 157, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            z-index: 10;
            overflow: hidden;
        }

        .seed-syllable:hover {
            box-shadow: 0 0 50px var(--neon-green);
            transform: scale(1.05);
        }

        .seed-syllable span {
            font-size: 4rem;
            color: #fff;
            text-shadow: 0 0 15px #fff;
        }

        #upload-input {
            display: none;
        }

        /* ìº”ë²„ìŠ¤ (ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°) */
        canvas {
            max-width: 300px;
            max-height: 300px;
            border: 1px solid #333;
            margin-bottom: 30px;
            display: none; /* ì´ˆê¸°ì—” ìˆ¨ê¹€ */
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        }

        /* ê²°ê³¼ ì¹´ë“œ ì„¹ì…˜ */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            width: 90%;
            max-width: 1000px;
            padding-bottom: 50px;
        }

        .card {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid #333;
            padding: 20px;
            border-radius: 0; /* ì‚¬ì´ë²„í‘í¬ ëŠë‚Œ */
            position: relative;
            transition: transform 0.2s;
            clip-path: polygon(10% 0, 100% 0, 100% 90%, 90% 100%, 0 100%, 0 10%);
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: #555;
        }

        .card-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
            color: #aaa;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .card-desc {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 15px;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #333;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            box-shadow: 0 0 10px currentColor;
        }

        .rgb-code {
            font-family: monospace;
            font-size: 0.7rem;
            color: #555;
            margin-top: 10px;
            text-align: right;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ë¡œë”© íš¨ê³¼ */
        .scanning {
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 20px var(--neon-green); }
            50% { box-shadow: 0 0 50px var(--neon-green), 0 0 80px var(--neon-green); }
            100% { box-shadow: 0 0 20px var(--neon-green); }
        }

    </style>
</head>
<body>

    <div class="bubbles"></div>

    <h1>ZERO KARMA</h1>
    <div class="subtitle">Yogini Tantra Fuzzy Analyzer</div>

    <div class="mandala-container">
        <svg class="mantra-ring" viewBox="0 0 300 300">
            <path id="circlePath" d="M 150, 150 m -120, 0 a 120,120 0 0,1 240,0 a 120,120 0 0,1 -240,0" fill="none"/>
            <text fill="#00ff9d" font-size="14" font-family="monospace" letter-spacing="4">
                <textPath href="#circlePath">
                    OM TARE TUTTARE TURE SOHA à¥ OM TARE TUTTARE TURE SOHA à¥
                </textPath>
            </text>
        </svg>

        <label for="upload-input" class="seed-syllable" id="drop-zone">
            <span>ğ‘–ğ‘–¾</span>
        </label>
        <input type="file" id="upload-input" accept="image/*">
    </div>

    <canvas id="canvas"></canvas>

    <div id="results" class="results-grid">
        </div>

<script>
    const uploadInput = document.getElementById('upload-input');
    const dropZone = document.getElementById('drop-zone');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const resultsDiv = document.getElementById('results');

    // ë§Œë‹¤ë¼ 5ì§€í˜œ ì„¤ì • (Zero Karma Style)
    const TARGETS = {
        'Blue':   { 
            hue: 240, 
            sanskrit: 'Akshobhya',
            wisdom: 'ëŒ€ì›ê²½ì§€ (Mirror Wisdom)', 
            desc: 'ë¶„ë…¸ë¥¼ ëƒ‰ì² í•œ ê±°ìš¸ë¡œ ë¹„ì¶”ëŠ” í˜', 
            color: '#00ccff' 
        },
        'Yellow': { 
            hue: 60,  
            sanskrit: 'Ratnasambhava',
            wisdom: 'í‰ë“±ì„±ì§€ (Equality Wisdom)', 
            desc: 'ìì¡´ê°ê³¼ ë‚´ë©´ì˜ í’ìš”', 
            color: '#ffcc00' 
        },
        'Red':    { 
            hue: 0,   
            sanskrit: 'Amitabha',
            wisdom: 'ë¬˜ê´€ì°°ì§€ (Discriminating Wisdom)', 
            desc: 'ìš•ë§ì„ ìë¹„ë¡œ ìŠ¹í™”í•˜ëŠ” ì—´ì •', 
            color: '#ff0055' 
        },
        'Green':  { 
            hue: 120, 
            sanskrit: 'Amoghasiddhi',
            wisdom: 'ì„±ì†Œì‘ì§€ (All-Accomplishing)', 
            desc: 'ì§ˆíˆ¬ë¥¼ ì‹¤í–‰ë ¥ìœ¼ë¡œ ë°”ê¾¸ëŠ” ì—ë„ˆì§€', 
            color: '#00ff9d' 
        },
        'White':  { 
            hue: 0,   
            sanskrit: 'Vairocana',
            wisdom: 'ë²•ê³„ì²´ì„±ì§€ (Dharma-Realm)', 
            desc: 'ë¬´ì§€ë¥¼ ì”»ì–´ë‚´ëŠ” ìˆœìˆ˜', 
            color: '#ffffff' 
        }
    };

    // íŒŒì¼ ì„ íƒ ì‹œ
    uploadInput.addEventListener('change', handleFile);

    function handleFile(e) {
        const file = e.target.files[0];
        if (!file) return;

        // ë¡œë”© íš¨ê³¼
        dropZone.classList.add('scanning');
        dropZone.innerHTML = "<span>à¥</span>"; // OMìœ¼ë¡œ ë³€ê²½

        const img = new Image();
        img.onload = () => {
            canvas.style.display = 'block';
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            
            // 0.5ì´ˆ ë”œë ˆì´ í›„ ë¶„ì„ (ì˜ì‹ì  íš¨ê³¼)
            setTimeout(() => {
                analyzeFuzzy(ctx.getImageData(0, 0, canvas.width, canvas.height));
                dropZone.classList.remove('scanning');
                dropZone.innerHTML = "<span>ğ‘–ğ‘–¾</span>"; // ë‹¤ì‹œ TAMìœ¼ë¡œ
            }, 500);
        };
        img.src = URL.createObjectURL(file);
    }

    // RGB -> HSV ë³€í™˜
    function rgbToHsv(r, g, b) {
        r /= 255, g /= 255, b /= 255;
        let max = Math.max(r, g, b), min = Math.min(r, g, b);
        let h, s, v = max;
        let d = max - min;
        s = max == 0 ? 0 : d / max;
        if (max == min) { h = 0; } 
        else {
            switch (max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }
        return [h * 360, s, v];
    }

    // í¼ì§€ ë¡œì§ í•¨ìˆ˜
    function getMembership(value, target, range = 45) {
        let diff = Math.abs(value - target);
        if (diff > 180) diff = 360 - diff; 
        if (diff > range) return 0;
        return 1 - (diff / range);
    }

    // ë¶„ì„ ë° ë Œë”ë§
    function analyzeFuzzy(imageData) {
        const data = imageData.data;
        let scores = { 'Blue':0, 'Yellow':0, 'Red':0, 'Green':0, 'White':0 };
        let rgbSums = { 'Blue':[0,0,0], 'Yellow':[0,0,0], 'Red':[0,0,0], 'Green':[0,0,0], 'White':[0,0,0] };
        let pixelCounts = { 'Blue':0, 'Yellow':0, 'Red':0, 'Green':0, 'White':0 };

        for (let i = 0; i < data.length; i += 4) {
            let r = data[i], g = data[i+1], b = data[i+2];
            let [h, s, v] = rgbToHsv(r, g, b);

            // White Detection
            let whiteScore = 0;
            if (s < 0.15 && v > 0.8) {
                whiteScore = (1 - s) * v;
                scores['White'] += whiteScore;
                rgbSums['White'][0] += r * whiteScore;
                rgbSums['White'][1] += g * whiteScore;
                rgbSums['White'][2] += b * whiteScore;
                pixelCounts['White'] += whiteScore;
            }

            // Color Detection
            if (whiteScore < 0.8) { 
                for (let key of ['Red', 'Blue', 'Yellow', 'Green']) {
                    let mem = getMembership(h, TARGETS[key].hue);
                    let intensity = mem * s * v; 
                    
                    if (intensity > 0) {
                        scores[key] += intensity;
                        rgbSums[key][0] += r * intensity;
                        rgbSums[key][1] += g * intensity;
                        rgbSums[key][2] += b * intensity;
                        pixelCounts[key] += intensity;
                    }
                }
            }
        }

        let totalScore = Object.values(scores).reduce((a, b) => a + b, 0);
        
        // ì¹´ë“œ ìƒì„±
        resultsDiv.innerHTML = '';
        for (let key in TARGETS) {
            let percent = totalScore > 0 ? (scores[key] / totalScore * 100).toFixed(1) : 0;
            
            let avgR = pixelCounts[key] > 0 ? Math.round(rgbSums[key][0] / pixelCounts[key]) : 0;
            let avgG = pixelCounts[key] > 0 ? Math.round(rgbSums[key][1] / pixelCounts[key]) : 0;
            let avgB = pixelCounts[key] > 0 ? Math.round(rgbSums[key][2] / pixelCounts[key]) : 0;

            if (percent > 0) { // 0%ëŠ” ìˆ¨ê¹€
                let card = document.createElement('div');
                card.className = 'card';
                card.style.borderColor = TARGETS[key].color;
                card.innerHTML = `
                    <div class="card-title" style="color:${TARGETS[key].color}">${TARGETS[key].sanskrit}</div>
                    <div class="card-value" style="color:${TARGETS[key].color}">${percent}%</div>
                    <div class="card-desc">
                        <strong>${TARGETS[key].wisdom}</strong><br>
                        ${TARGETS[key].desc}
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width:${percent}%; background:${TARGETS[key].color}"></div>
                    </div>
                    <div class="rgb-code">RGB(${avgR}, ${avgG}, ${avgB})</div>
                `;
                resultsDiv.appendChild(card);
            }
        }
    }
</script>
</body>
</html>