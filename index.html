<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZERO KARMA : INTEGRATED RITUAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+KR:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-green: #00ff9d; --neon-blue: #00ccff; --neon-yellow: #ffcc00;
            --neon-red: #ff0055; --neon-white: #ffffff;
            --dark-bg: #050505; --glass: rgba(20, 20, 20, 0.85);
        }

        body {
            margin: 0; background-color: var(--dark-bg); color: #fff;
            font-family: 'Noto Sans KR', sans-serif; overflow-x: hidden;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; padding: 20px; box-sizing: border-box;
        }

        .bubbles {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at 50% 50%, rgba(0, 255, 157, 0.1) 0%, transparent 60%);
            pointer-events: none;
        }

        h1 {
            font-family: 'Orbitron', sans-serif; font-size: 1.8rem; color: var(--neon-green);
            text-shadow: 0 0 10px var(--neon-green); letter-spacing: 3px; text-align: center; margin-top: 10px;
        }

        .subtitle { font-size: 0.8rem; color: #888; margin-bottom: 30px; text-transform: uppercase; font-family: 'Orbitron', sans-serif; }

        /* ì—…ë¡œë“œ ì„¹ì…˜ */
        .upload-container {
            position: relative; width: 65vw; height: 65vw; max-width: 220px; max-height: 220px;
            display: flex; justify-content: center; align-items: center; margin-bottom: 40px;
        }
        .mantra-ring { position: absolute; width: 100%; height: 100%; animation: spin 25s linear infinite; }
        .seed-syllable {
            width: 68%; height: 68%; border-radius: 50%; background: rgba(255,255,255,0.05);
            backdrop-filter: blur(5px); border: 2px solid var(--neon-green);
            box-shadow: 0 0 25px rgba(0, 255, 157, 0.25); display: flex; flex-direction: column;
            justify-content: center; align-items: center; cursor: pointer; z-index: 10; transition: all 0.3s ease;
            text-align: center;
        }
        .seed-syllable:hover { box-shadow: 0 0 40px rgba(0, 255, 157, 0.4); transform: scale(1.02); }
        .seed-syllable:active { transform: scale(0.95); }
        .seed-icon { font-size: 2.5rem; color: #fff; line-height: 1.2; }
        .upload-hint { font-family: 'Orbitron', sans-serif; font-size: 0.6rem; color: var(--neon-green); margin-top: 8px; letter-spacing: 1px; font-weight: 700; }
        #upload-input { display: none; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .scanning { animation: pulse 1s infinite; }
        @keyframes pulse { 50% { box-shadow: 0 0 50px var(--neon-green); } }

        /* ë§Œë‹¤ë¼ ê·¸ë¦¬ë“œ */
        #mandala-grid {
            display: grid; gap: 15px; margin-bottom: 40px;
            grid-template-areas: ". north ." "west center east" ". south .";
            width: 100%; max-width: 450px;
        }
        .card {
            background: var(--glass); border: 1px solid #333; padding: 15px 10px;
            border-top: 4px solid; display: flex; flex-direction: column;
            align-items: center; text-align: center; position: relative;
            aspect-ratio: 1 / 1; justify-content: space-between;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .direction-label { font-size: 0.55rem; color: #888; letter-spacing: 2px; margin-bottom: auto; font-family: 'Orbitron', sans-serif; }
        .card-titles { margin: auto 0; }
        .card-title-kr { font-size: 0.95rem; font-weight: 700; margin-bottom: 4px; word-break: keep-all;}
        .card-title-en { font-size: 0.65rem; color: #bbb; font-family: 'Orbitron', sans-serif; letter-spacing: 0.5px;}
        .card-value { font-size: 1.2rem; font-weight: bold; margin-top: auto; font-family: 'Orbitron', sans-serif; }
        
        /* ì§„ë‹¨ ë°•ìŠ¤ */
        #diagnosis-section { width: 100%; max-width: 500px; display: none; animation: slideUp 0.8s ease-out; margin-bottom: 30px; }
        .diagnosis-card {
            background: rgba(0,0,0,0.9); border: 2px solid var(--neon-green); padding: 25px 20px;
            text-align: center; box-shadow: 0 0 30px rgba(0, 255, 157, 0.15);
        }
        .diag-header { font-size: 1.1rem; color: #fff; margin-bottom: 15px; font-weight: 700; letter-spacing: 1px; }
        .diag-result { font-size: 1.3rem; font-weight: 800; color: var(--neon-green); word-break: keep-all; line-height: 1.4; margin-bottom: 15px; }
        .diag-desc { font-size: 0.95rem; color: #ccc; line-height: 1.6; font-weight: 300; word-break: keep-all; border-top: 1px solid #333; padding-top: 15px; }

        /* ì²˜ë°© ì„¹ì…˜ (í†µí•©í˜•) */
        #remedy-section { width: 100%; max-width: 500px; display: none; animation: slideUp 1s ease-out; padding-bottom: 60px; }
        
        .remedy-box { 
            background: var(--glass); border-left: 4px solid #555; padding: 25px 20px; margin-bottom: 25px; 
            position: relative;
        }
        .remedy-label { font-size: 0.9rem; color: #bbb; margin-bottom: 12px; display: block; font-weight: 700; letter-spacing: 0.5px;}
        .sutra-text { font-size: 1.05rem; font-style: italic; color: #ddd; line-height: 1.6; word-break: keep-all; margin-bottom: 15px; }
        .practice-text { font-size: 1rem; color: #fff; line-height: 1.7; word-break: keep-all; white-space: pre-line; margin-bottom: 15px;}
        
        .mantra-box-style { text-align: center; border: 2px dashed var(--neon-green); background: rgba(0, 255, 157, 0.05);}
        .mantra-text { 
            font-family: 'Orbitron', monospace; color: var(--neon-green); font-size: 1.2rem; letter-spacing: 1.5px; 
            margin-bottom: 15px; display: block;
        }

        /* --- í†µí•©ëœ ì•¡ì…˜ ë²„íŠ¼ & ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ --- */
        .action-container { 
            margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); 
            display: flex; gap: 10px; flex-wrap: wrap; 
        }
        .action-container-center { justify-content: center; }

        .action-btn {
            display: inline-flex; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.05); color: #aaa; text-decoration: none;
            padding: 8px 16px; font-size: 0.8rem; border: 1px solid #444; border-radius: 4px;
            transition: all 0.2s; font-family: 'Noto Sans KR', sans-serif; cursor: pointer;
        }
        .action-btn:hover { border-color: var(--neon-green); color: #fff; background: rgba(0, 255, 157, 0.1); }
        .action-btn span { margin-right: 5px; }

        /* ìŠ¤í… ë°”ì´ ìŠ¤í… ë¦¬ìŠ¤íŠ¸ */
        .step-list { 
            list-style: none; padding: 0; margin: 10px 0 0 0; text-align: left; 
            background: rgba(0,0,0,0.3); padding: 15px; border-radius: 5px;
        }
        .step-list li { 
            margin-bottom: 10px; font-size: 0.9rem; line-height: 1.5; color: #ccc; 
            display: flex; align-items: flex-start;
        }
        .step-list li:last-child { margin-bottom: 0; }
        .step-num { 
            color: var(--neon-green); font-weight: bold; margin-right: 8px; min-width: 20px; 
            font-family: 'Orbitron', sans-serif; font-size: 0.8rem; margin-top: 2px;
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="bubbles"></div>
    <h1>ZERO KARMA</h1>
    <div class="subtitle">Integrated Ritual System</div>

    <div class="upload-container">
        <svg class="mantra-ring" viewBox="0 0 300 300">
            <path id="circlePath" d="M 150, 150 m -120, 0 a 120,120 0 0,1 240,0 a 120,120 0 0,1 -240,0" fill="none"/>
            <text fill="#00ff9d" font-size="13" font-family="monospace" letter-spacing="3.5" font-weight="bold">
                <textPath href="#circlePath">OM TARE TUTTARE TURE SVAHA à¥ OM TARE TUTTARE TURE SVAHA à¥</textPath>
            </text>
        </svg>
        <label for="upload-input" class="seed-syllable" id="drop-zone">
            <span class="seed-icon">ğ‘–ğ‘–¾</span>
            <span class="upload-hint">CLICK TO UPLOAD IMAGE</span>
        </label>
        <input type="file" id="upload-input" accept="image/*">
    </div>

    <div id="mandala-grid"></div>

    <div id="diagnosis-section">
        <div class="diagnosis-card" id="diag-card">
            <div class="diag-header">í˜„ì¬ ì—ë„ˆì§€ ì§„ë‹¨</div>
            <div class="diag-result" id="diag-result"></div>
            <div class="diag-desc" id="diag-desc"></div>
        </div>
    </div>

    <div id="remedy-section">
        
        <div class="remedy-box" id="sutra-box">
            <span class="remedy-label">â… . ìˆ˜íŠ¸ë¼ (SUTRA WISDOM)</span>
            <div class="sutra-text" id="sutra-text"></div>
            <div class="action-container" id="sutra-actions">
                </div>
        </div>

        <div class="remedy-box" id="practice-box">
            <span class="remedy-label">â…¡. íƒ„íŠ¸ë¼ (TANTRA PRACTICE)</span>
            <div class="practice-text" id="practice-text"></div>
            <ul class="step-list" id="practice-steps"></ul>
        </div>

        <div class="remedy-box mantra-box-style" id="mantra-box">
            <span class="remedy-label" style="margin-bottom: 15px;">â…¢. ë§ŒíŠ¸ë¼ (MANTRA CODE)</span>
            <div class="mantra-text" id="mantra-text"></div>
            <div class="action-container action-container-center" id="mantra-actions">
                </div>
        </div>
    </div>

    <canvas id="canvas" style="display:none;"></canvas>

<script>
    const uploadInput = document.getElementById('upload-input');
    const dropZone = document.getElementById('drop-zone');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // UI Refs
    const mandalaGrid = document.getElementById('mandala-grid');
    const diagnosisSection = document.getElementById('diagnosis-section');
    const remedySection = document.getElementById('remedy-section');

    // ê¸°ë³¸ ë§Œë‹¤ë¼ ì •ë³´
    const BASE_INFO = {
        'White': { color: 'var(--neon-white)', gridArea: 'center', direction_kr: 'ì¤‘ì•™ (CENTER)', sanskrit_kr: 'ë¹„ë¡œìë‚˜ë¶ˆ', wisdom_kr: 'ë²•ê³„ì²´ì„±ì§€', hue: 0 },
        'Blue':  { color: 'var(--neon-blue)',  gridArea: 'east',   direction_kr: 'ë™ë°© (EAST)',   sanskrit_kr: 'ì•„ì´‰ë¶ˆ',     wisdom_kr: 'ëŒ€ì›ê²½ì§€',   hue: 240 },
        'Yellow':{ color: 'var(--neon-yellow)',gridArea: 'south',  direction_kr: 'ë‚¨ë°© (SOUTH)',  sanskrit_kr: 'ë³´ìƒë¶ˆ',     wisdom_kr: 'í‰ë“±ì„±ì§€',   hue: 60 },
        'Red':   { color: 'var(--neon-red)',   gridArea: 'west',   direction_kr: 'ì„œë°© (WEST)',   sanskrit_kr: 'ì•„ë¯¸íƒ€ë¶ˆ',   wisdom_kr: 'ë¬˜ê´€ì°°ì§€',   hue: 0 },
        'Green': { color: 'var(--neon-green)', gridArea: 'north',  direction_kr: 'ë¶ë°© (NORTH)',  sanskrit_kr: 'ë¶ˆê³µì„±ì·¨ë¶ˆ', wisdom_kr: 'ì„±ì†Œì‘ì§€',   hue: 120 }
    };
    const MANDALA_KEYS = ['Green', 'Red', 'White', 'Blue', 'Yellow'];

    uploadInput.addEventListener('change', handleFile);

    function handleFile(e) {
        const file = e.target.files[0];
        if (!file) return;
        resetUI();
        dropZone.classList.add('scanning'); 
        dropZone.querySelector('.seed-icon').innerHTML = "à¥"; 
        dropZone.querySelector('.upload-hint').innerHTML = "ANALYZING...";

        const img = new Image();
        img.onload = () => {
            const MAX_SIZE = 500;
            let w = img.width, h = img.height;
            if (w > h) { if (w > MAX_SIZE) { h *= MAX_SIZE/w; w = MAX_SIZE; } } 
            else { if (h > MAX_SIZE) { w *= MAX_SIZE/h; h = MAX_SIZE; } }
            canvas.width = w; canvas.height = h; ctx.drawImage(img, 0, 0, w, h);
            setTimeout(() => { 
                analyzeFuzzy(ctx.getImageData(0,0,w,h)); 
                dropZone.classList.remove('scanning'); 
                dropZone.querySelector('.seed-icon').innerHTML = "ğ‘–ğ‘–¾"; 
                dropZone.querySelector('.upload-hint').innerHTML = "CLICK TO UPLOAD IMAGE";
            }, 800);
        };
        img.src = URL.createObjectURL(file);
    }

    function resetUI() {
        mandalaGrid.innerHTML = '';
        diagnosisSection.style.display = 'none';
        remedySection.style.display = 'none';
    }

    // --- í¼ì§€ ë¡œì§ & ì˜¤ë¼í´ ë°ì´í„°ë² ì´ìŠ¤ ---
    function getOracleData(primary, secondary, intensity) {
        const isExtreme = intensity > 50; 
        
        const DB = {
            'White': {
                extreme: {
                    diag: "ì••ë„ì ì¸ í˜¼ë€ â” ê·¼ì›ì  ì§€í˜œë¡œì˜ ìŠ¹í™”",
                    desc: "í˜„ì¬ ë‹¹ì‹ ì€ ë°©í–¥ì„ ìƒì€ í˜¼ë€ í˜¹ì€ ê¹Šì€ ê³µí—ˆí•¨ì„ ëŠë¼ê³  ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ í…… ë¹ˆ ìƒíƒœì•¼ë§ë¡œ ì–´ë–¤ ê·¸ë¦¼ì´ë“  ê·¸ë¦´ ìˆ˜ ìˆëŠ” ë¬´í•œí•œ ì ì¬ë ¥(ê³µì„±)ì…ë‹ˆë‹¤.",
                    sutra: "ã€Œí—ˆê³µì€ ë¶€ì„œì§€ì§€ ì•Šìœ¼ë‚˜, ë§Œìƒì€ í—ˆê³µ ì†ì—ì„œ ìƒê²¨ë‚˜ê³  ì‚¬ë¼ì§„ë‹¤.ã€ - ëŠ¥ì—„ê²½",
                    sutra_link_name: "ëŠ¥ì—„ê²½(Shurangama Sutra) ì›ë¬¸ ë³´ê¸°",
                    sutra_query: "Shurangama Sutra text pdf",
                    prac: "[ê³µì„± ì²´í—˜] ì‹œì„ ì„ í•˜ëŠ˜ì— ê³ ì •í•˜ê³  ë‹¨í˜¸í•˜ê²Œ 'íŒŸ(PHAT)!' í•˜ê³  ì™¸ì³ ìƒê°ì„ ëŠìœ¼ì‹­ì‹œì˜¤.",
                    steps: [
                        "í¸ì•ˆí•˜ê²Œ ì•‰ì•„ ëˆˆì„ ë°˜ì¯¤ ëœ¹ë‹ˆë‹¤.",
                        "ëˆˆì•ì˜ í—ˆê³µì„ ì‘ì‹œí•˜ë©° 'ì´ ìƒê°ì€ ì–´ë””ì„œ ì™”ëŠ”ê°€?' ì§ˆë¬¸í•©ë‹ˆë‹¤.",
                        "ìƒê°ì´ ê¼¬ë¦¬ë¥¼ ë¬¼ë©´ ë°•ìˆ˜ë¥¼ ì¹˜ë“¯ ê°•í•˜ê²Œ 'íŒŸ(PHAT)!' í•˜ê³  ì™¸ì¹©ë‹ˆë‹¤.",
                        "ì†Œë¦¬ê°€ ì‚¬ë¼ì§„ ì§í›„ì˜ í…… ë¹ˆ ì¹¨ë¬µ(Gap)ì„ 1ë¶„ê°„ ê´€ì°°í•˜ì‹­ì‹œì˜¤."
                    ],
                    mantra: "OM VAIROCANA MALA SVAHA",
                    audio_query: "Vairocana Mantra chanting"
                },
                normal: {
                    diag: "ë¬´ì§€í•œ ìƒíƒœ â” ìˆœìˆ˜í•œ ë°±ì§€ë¡œì˜ íšŒê·€",
                    desc: "ì§€ê¸ˆ ë‹¹ì‹ ì˜ ë§ˆìŒì€ ë°±ì§€ì¥ì²˜ëŸ¼ ê¹¨ë—í•˜ì§€ë§Œ ì¡°ê¸ˆì€ ë§‰ë§‰í•œ ìƒíƒœì…ë‹ˆë‹¤. ì–µì§€ë¡œ ì±„ìš°ë ¤ í•˜ì§€ ë§ê³  ì´ ë§‘ìŒì„ ìœ ì§€í•˜ì‹­ì‹œì˜¤.",
                    sutra: "ã€Œë³¸ë˜ ë§ˆìŒì—ëŠ” í•œ ë¬¼ê±´ë„ ì—†ë‹¤.ã€ - ìœ¡ì¡°ë‹¨ê²½",
                    sutra_link_name: "ìœ¡ì¡°ë‹¨ê²½(Platform Sutra) ì›ë¬¸ ë³´ê¸°",
                    sutra_query: "Platform Sutra text pdf",
                    prac: "[í˜¸í¡ ê´€ì°°] ë‹¨ìˆœíˆ ë“¤ì–´ì˜¤ê³  ë‚˜ê°€ëŠ” ìˆ¨ì˜ ê°ê°ë§Œ 10ë²ˆ ì„¸ì‹­ì‹œì˜¤.",
                    steps: [
                        "ì½”ëì— ì˜ì‹ì„ ì§‘ì¤‘í•©ë‹ˆë‹¤.",
                        "ìˆ¨ì´ ë“¤ì–´ì˜¬ ë•Œ 'í•˜ë‚˜', ë‚˜ê°ˆ ë•Œ 'ë‘˜'ì„ ì…‰ë‹ˆë‹¤.",
                        "10ê¹Œì§€ ì„¸ê³  ë‹¤ì‹œ 1ë¡œ ëŒì•„ì˜µë‹ˆë‹¤.",
                        "ìˆ«ìë¥¼ ë†“ì¹˜ë©´ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤."
                    ],
                    mantra: "OM VAIROCANA HUM",
                    audio_query: "Maha Vairochana Mantra"
                }
            },
            'Blue': {
                extreme: {
                    diag: "í­ë°œì  ë¶„ë…¸ â” ê±°ìš¸ ê°™ì€ ì§€í˜œë¡œì˜ ìŠ¹í™”",
                    desc: "í˜„ì¬ ë‹¹ì‹ ì˜ ë‚´ë©´ì€ ëœ¨ê±°ìš´ ë¶„ë…¸ë¡œ ê°€ë“ ì°¨ ìˆìŠµë‹ˆë‹¤. ì´ ì—ë„ˆì§€ë¥¼ ìŠ¹í™”í•˜ë©´ ì‚¬ë¬¼ì„ ìˆëŠ” ê·¸ëŒ€ë¡œ ë¹„ì¶”ëŠ” 'ëŒ€ì›ê²½ì§€'ê°€ ë©ë‹ˆë‹¤.",
                    sutra: "ã€Œë¶„ë…¸ë¥¼ ë‹¤ìŠ¤ë¦¬ì§€ ëª»í•˜ëŠ” ìëŠ” ë…ì‚¬ë¥¼ í’ˆì— ì•ˆê³  ìëŠ” ê²ƒê³¼ ê°™ë‹¤.ã€ - ì…ë³´ë¦¬í–‰ë¡ ",
                    sutra_link_name: "ì…ë³´ë¦¬í–‰ë¡ (Bodhicharyavatara) ì›ë¬¸ ë³´ê¸°",
                    sutra_query: "Bodhicharyavatara text pdf",
                    prac: "[ë°”ì¦ˆë¼ ì •í™”] ì‹¬ì¥ì˜ í‘¸ë¥¸ 'í›”' ìê°€ ë¶ˆê¸¸ì„ ë¬¼ë¡œ ë°”ê¾¸ëŠ” ìƒìƒì„ í•˜ì‹­ì‹œì˜¤.",
                    steps: [
                        "ìì‹ ì˜ ì‹¬ì¥ì— ë¶ˆíƒ€ëŠ” ë¶‰ì€ ê³µì´ ìˆë‹¤ê³  ìƒìƒí•©ë‹ˆë‹¤ (ë¶„ë…¸).",
                        "ì •ìˆ˜ë¦¬ì—ì„œ ì‹œì›í•œ í‘¸ë¥¸ ê°ë¡œìˆ˜ê°€ ìŸì•„ì ¸ ë‚´ë¦½ë‹ˆë‹¤.",
                        "ë¬¼ì´ ì‹¬ì¥ì— ë‹¿ëŠ” ìˆœê°„ 'ì¹˜ì´ìµ' ì†Œë¦¬ì™€ í•¨ê»˜ ë¶ˆì´ êº¼ì§‘ë‹ˆë‹¤.",
                        "ëª¸ ë°–ìœ¼ë¡œ ê²€ì€ ì—°ê¸°ê°€ ë¹ ì ¸ë‚˜ê°€ëŠ” ê²ƒì„ ì§€ì¼œë³´ì‹­ì‹œì˜¤."
                    ],
                    mantra: "OM VAJRA CHANDA MAHA ROSHANA HUM PHAT",
                    audio_query: "Acala Mantra Budong Myoo"
                },
                normal: {
                    diag: "ì§€ë‚˜ì¹œ ëƒ‰ì •í•¨ â” í”ë“¤ë¦¬ì§€ ì•ŠëŠ” ë¶€ë™ì‹¬",
                    desc: "ë‹¹ì‹ ì€ í˜„ì¬ ê°ì •ì„ ì–µëˆ„ë¥´ê³  ì§€ë‚˜ì¹˜ê²Œ ì´ì„±ì ì…ë‹ˆë‹¤. ì´ ì°¨ê°€ì›€ì— ì˜¨ê¸°ë¥¼ ë”í•˜ë©´ ì–´ë–¤ ìƒí™©ì—ì„œë„ ìš”ë™ì¹˜ì§€ ì•ŠëŠ” ë¶€ë™ì‹¬ì´ ë©ë‹ˆë‹¤.",
                    sutra: "ã€Œê±°ìš¸ì€ ì‚¬ë¬¼ì„ ë¹„ì¶”ë˜ í”ì ì„ ë‚¨ê¸°ì§€ ì•ŠëŠ”ë‹¤.ã€ - ëŒ€ì›ê²½ì§€ì†¡",
                    sutra_link_name: "ìœ ë§ˆê²½(Vimalakirti Sutra) ì›ë¬¸ ë³´ê¸°",
                    sutra_query: "Vimalakirti Sutra text pdf",
                    prac: "[ê°ê´€í™”] ê°ì •ì„ ëº€ ì‚¬ì‹¤(Fact)ë§Œ ì¢…ì´ì— ì ì–´ë³´ì‹­ì‹œì˜¤.",
                    steps: [
                        "ìì‹ ì„ íˆ¬ëª…í•œ ê±°ìš¸ì´ë¼ê³  ìƒìƒí•©ë‹ˆë‹¤.",
                        "ë– ì˜¤ë¥´ëŠ” ê°ì •ì„ ê±°ìš¸ì— ë¹„ì¹œ ì˜ìƒìœ¼ë¡œ ë°”ë¼ë´…ë‹ˆë‹¤.",
                        "'ì´ê²ƒì€ ë‚´ ê²ƒì´ ì•„ë‹ˆë‹¤'ë¼ê³  ë˜ë‡ë‹ˆë‹¤.",
                        "ì˜ìƒì´ ì‚¬ë¼ì§„ í›„ ê±°ìš¸ì˜ ê¹¨ë—í•¨ë§Œ ëŠë‚ë‹ˆë‹¤."
                    ],
                    mantra: "OM AKSHOBHYA VAJRA SVAHA",
                    audio_query: "Akshobhya Buddha Mantra"
                }
            },
            'Yellow': {
                extreme: {
                    diag: "ë¹„ëŒ€í•œ ìì•„(ì˜¤ë§Œ) â” í‰ë“±í•œ í’ìš”ë¡œì˜ ìŠ¹í™”",
                    desc: "ìì‹ ì„ ë‚¨ë³´ë‹¤ ë†’ê²Œ ì—¬ê¸°ê±°ë‚˜ ì—´ë“±ê°ì„ ëŠë¼ëŠ” ìƒíƒœì…ë‹ˆë‹¤. ì´ ì—ë„ˆì§€ë¥¼ ìŠ¹í™”í•˜ë©´ ì§„ì •í•œ ë‚´ë©´ì˜ í’ìš”ì™€ ê´€ëŒ€í•¨ì„ ì–»ê²Œ ë©ë‹ˆë‹¤.",
                    sutra: "ã€Œë‚˜ë¼ëŠ” ìƒ(Ego)ì´ ìˆìœ¼ë©´ ë³´ì‚´ì´ ì•„ë‹ˆë‹¤.ã€ - ê¸ˆê°•ê²½",
                    sutra_link_name: "ê¸ˆê°•ê²½(Diamond Sutra) ì›ë¬¸ ë³´ê¸°",
                    sutra_query: "Diamond Sutra text pdf",
                    prac: "[ì˜¤ì²´íˆ¬ì§€] ìì¡´ì‹¬ì„ ë•…ì— ë‚´ë ¤ë†“ëŠ” ì ˆì„ 3ë²ˆ í•˜ì‹­ì‹œì˜¤.",
                    steps: [
                        "ì¼ì–´ì„œì„œ í•©ì¥í•˜ê³  ë‚´ ì•ˆì˜ ì˜¤ë§Œí•¨ì„ ì¸ì •í•©ë‹ˆë‹¤.",
                        "ì²œì²œíˆ ë¬´ë¦, íŒ”ê¿ˆì¹˜, ì´ë§ˆë¥¼ ë•…ì— ëŒ‘ë‹ˆë‹¤ (ì˜¤ì²´íˆ¬ì§€).",
                        "ë•…ì˜ ë‚®ì€ ê³³ì— ë¨¸ë¦¬ë¥¼ ëŒ€ê³  'ë‚˜ëŠ” í™ìœ¼ë¡œ ëŒì•„ê°„ë‹¤' ìƒê°í•©ë‹ˆë‹¤.",
                        "ì¼ì–´ë‚˜ë©° ìƒˆë¡œìš´ ê²¸ì†í•œ ìì•„ë¡œ ë‹¤ì‹œ íƒœì–´ë‚©ë‹ˆë‹¤."
                    ],
                    mantra: "OM RATNASAMBHAVA TRAM",
                    audio_query: "Ratnasambhava Mantra"
                },
                normal: {
                    diag: "í˜„ì‹¤ ì•ˆì£¼ â” ë² í‘¸ëŠ” ë§ˆìŒì˜ í™•ì¥",
                    desc: "í˜„ì¬ ìƒíƒœì— ë§Œì¡±í•˜ê³  ìˆì§€ë§Œ ì„±ì¥ì´ ë©ˆì¶° ìˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì´ ê°€ì§„ ê²ƒì„ íƒ€ì¸ê³¼ ë‚˜ëˆŒ ë•Œ, ê·¸ ì—ë„ˆì§€ëŠ” ë” í° í’ìš”ë¡œ ëŒì•„ì˜µë‹ˆë‹¤.",
                    sutra: "ã€Œì§„í™ ì†ì—ì„œë„ ì—°ê½ƒì€ í”¼ì–´ë‚œë‹¤.ã€ - ë²•í™”ê²½",
                    sutra_link_name: "ë²•í™”ê²½(Lotus Sutra) ì›ë¬¸ ë³´ê¸°",
                    sutra_query: "Lotus Sutra text pdf",
                    prac: "[ë³´ì‹œ ìˆ˜í–‰] ì˜¤ëŠ˜ íƒ€ì¸ì—ê²Œ ì‘ì€ ì¹œì ˆì„ ë² í‘¸ì‹­ì‹œì˜¤.",
                    steps: [
                        "ê°€ìŠ´ ì¤‘ì•™ì— í™©ê¸ˆìƒ‰ ë³´ì„ì´ ë¹›ë‚œë‹¤ê³  ìƒìƒí•©ë‹ˆë‹¤.",
                        "ìˆ¨ì„ ë‚´ì‰´ ë•Œë§ˆë‹¤ í™©ê¸ˆë¹›ì´ ì£¼ë³€ìœ¼ë¡œ í¼ì ¸ë‚˜ê°‘ë‹ˆë‹¤.",
                        "ê·¸ ë¹›ì´ ë‹¿ëŠ” ëª¨ë“  ì‚¬ëŒì—ê²Œ í’ìš”ë¥¼ ì„ ë¬¼í•©ë‹ˆë‹¤.",
                        "'ë‚˜ëŠ” ì´ë¯¸ ì¶©ë¶„í•˜ë‹¤'ë¼ê³  3ë²ˆ í™•ì–¸í•©ë‹ˆë‹¤."
                    ],
                    mantra: "OM RATNA SURYA SVAHA",
                    audio_query: "Yellow Jambhala Mantra"
                }
            },
            'Red': {
                extreme: {
                    diag: "íƒ€ì˜¤ë¥´ëŠ” ì§‘ì°© â” ì°½ì¡°ì  ìë¹„ì‹¬ìœ¼ë¡œì˜ ìŠ¹í™”",
                    desc: "íŠ¹ì • ëŒ€ìƒì´ë‚˜ ìš•ë§ì— ê°•í•˜ê²Œ ë§¤ì—¬ ìˆìŠµë‹ˆë‹¤. ì´ ëœ¨ê±°ìš´ ì—ë„ˆì§€ë¥¼ íƒ€ì¸ì„ ìœ„í•´ ëŒë¦°ë‹¤ë©´, ìœ„ëŒ€í•œ ìë¹„ì‹¬ê³¼ ì°½ì¡°ì„±ìœ¼ë¡œ ë³€í•©ë‹ˆë‹¤.",
                    sutra: "ã€Œì• ìš•ì€ íšƒë¶ˆì„ ì¡ê³  ë°”ëŒì„ ê±°ìŠ¬ëŸ¬ ê°€ëŠ” ê²ƒê³¼ ê°™ë‹¤.ã€ - ì‚¬ì‹­ì´ì¥ê²½",
                    sutra_link_name: "ì‚¬ì‹­ì´ì¥ê²½ ì›ë¬¸ ë³´ê¸°",
                    sutra_query: "Sutra of Forty-two Chapters text pdf",
                    prac: "[ë¶€ì •ê´€] ì´ ìš•ë§ì˜ ëŒ€ìƒì´ ë¼ˆì™€ ì‚´ì¼ ë¿ì„ì„ ì§ì‹œí•˜ì‹­ì‹œì˜¤.",
                    steps: [
                        "ì§‘ì°©í•˜ê³  ìˆëŠ” ëŒ€ìƒ(ì‚¬ëŒ/ë¬¼ê±´)ì„ ë– ì˜¬ë¦½ë‹ˆë‹¤.",
                        "ê·¸ ëŒ€ìƒì˜ í”¼ë¶€ê°€ ë²—ê²¨ì§€ê³  ë¼ˆë§Œ ë‚¨ì€ ëª¨ìŠµì„ ìƒìƒí•©ë‹ˆë‹¤ (í•´ê³¨).",
                        "ê·¸ ë¼ˆê°€ ê°€ë£¨ê°€ ë˜ì–´ ë°”ëŒì— í©ì–´ì§€ëŠ” ê²ƒì„ ë´…ë‹ˆë‹¤.",
                        "ë¶ˆíƒ€ëŠ” ë§ˆìŒì´ ì¬ê°€ ë˜ì–´ ì°¨ê°‘ê²Œ ì‹ëŠ” ê²ƒì„ ëŠë‚ë‹ˆë‹¤."
                    ],
                    mantra: "OM AMITABHA HRIH SVAHA",
                    audio_query: "Amitabha Buddha Mantra Hrih"
                },
                normal: {
                    diag: "ì¸ê°„ì  í˜¸ê° â” ë³´í¸ì  ì‚¬ë‘ìœ¼ë¡œì˜ í™•ì¥",
                    desc: "ë‹¹ì‹ ì€ ë”°ëœ»í•œ ë§ˆìŒì„ ê°€ì§€ê³  ìˆì§€ë§Œ ê·¸ ë²”ìœ„ê°€ ì¢ìŠµë‹ˆë‹¤. ë‚´ ê°€ì¡±ì„ ë„˜ì–´ ì‹«ì–´í•˜ëŠ” ì‚¬ëŒì—ê²Œê¹Œì§€ ê·¸ ì˜¨ê¸°ë¥¼ í™•ì¥í•˜ì‹­ì‹œì˜¤.",
                    sutra: "ã€Œìë¹„ì‹¬ì€ ì ì„ ì¹œêµ¬ë¡œ ë§Œë“¤ê³ , ë…ì„ ì•½ìœ¼ë¡œ ë°”ê¾¼ë‹¤.ã€ - ìë¹„ê²½",
                    sutra_link_name: "ìë¹„ê²½(Metta Sutta) ì›ë¬¸ ë³´ê¸°",
                    sutra_query: "Metta Sutta text pdf",
                    prac: "[í†µë Œ ìˆ˜í–‰] ì„¸ìƒì˜ ê³ í†µì„ ë“¤ì´ë§ˆì‹œê³ , í–‰ë³µì„ ë‚´ì‰¬ì‹­ì‹œì˜¤.",
                    steps: [
                        "ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒì´ë‚˜ ê·€ì—¬ìš´ ë™ë¬¼ì„ ë– ì˜¬ë¦½ë‹ˆë‹¤.",
                        "ê²€ì€ ì—°ê¸°(ê·¸ë“¤ì˜ ê³ í†µ)ë¥¼ ë“¤ì´ë§ˆì…” ë‚´ ì‹¬ì¥ì—ì„œ íƒœì›ë‹ˆë‹¤.",
                        "í•˜ì–€ ë¹›(ë‚˜ì˜ í–‰ë³µ)ì„ ë‚´ì‰¬ë©° ê·¸ë“¤ì—ê²Œ ë³´ëƒ…ë‹ˆë‹¤.",
                        "ì´ ëŒ€ìƒì„ ì‹«ì–´í•˜ëŠ” ì‚¬ëŒì—ê²Œê¹Œì§€ í™•ì¥í•©ë‹ˆë‹¤."
                    ],
                    mantra: "OM ARO LIK SVAHA",
                    audio_query: "Guanyin Mantra Compassion"
                }
            },
            'Green': {
                extreme: {
                    diag: "ê·¹ì‹¬í•œ ë¶ˆì•ˆ â” ê±°ì¹¨ì—†ëŠ” ì‹¤í–‰ë ¥ìœ¼ë¡œì˜ ìŠ¹í™”",
                    desc: "ë¬´ì–¸ê°€ì— ì«“ê¸°ë“¯ ì´ˆì¡°í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ë¶ˆì•ˆì€ ì—­ì„¤ì ìœ¼ë¡œ ê°€ì¥ ê°•ë ¥í•œ í–‰ë™ ì—ë„ˆì§€ì…ë‹ˆë‹¤. ìƒê°ì„ ë©ˆì¶”ê³  ëª¸ì„ ì›€ì§ì´ì‹­ì‹œì˜¤.",
                    sutra: "ã€Œê³¼ê±°ëŠ” ì§€ë‚˜ê°”ê³  ë¯¸ë˜ëŠ” ì˜¤ì§€ ì•Šì•˜ë‹¤. ì˜¤ì§ ì§€ê¸ˆë¿ì´ë‹¤.ã€ - ì•„í•¨ê²½",
                    sutra_link_name: "ë°˜ì•¼ì‹¬ê²½(Heart Sutra) ì›ë¬¸ ë³´ê¸°",
                    sutra_query: "Heart Sutra text pdf",
                    prac: "[ê·¸ë¼ìš´ë”©] ì‹ ë°œì„ ë²—ê³  ë§¨ë°œë¡œ ë•…ì„ ë”›ê³  ê±¸ìœ¼ì‹­ì‹œì˜¤.",
                    steps: [
                        "ì¼ì–´ì„œì„œ ë°œë°”ë‹¥ì— ì˜ì‹ì„ ë‘¡ë‹ˆë‹¤.",
                        "ì˜¤ë¥¸ë°œì„ ë“¤ ë•Œ 'ë“¦', ë†“ì„ ë•Œ 'ë†“ìŒ'ì„ ì•Œì•„ì°¨ë¦½ë‹ˆë‹¤.",
                        "ì•„ì£¼ ì²œì²œíˆ ë°© ì•ˆì„ ê±·ìŠµë‹ˆë‹¤.",
                        "ë¨¸ë¦¬ì˜ ì—´ê¸°ê°€ ë°œë°”ë‹¥ìœ¼ë¡œ ë‚´ë ¤ê°€ ë•…ìœ¼ë¡œ ë¹ ì ¸ë‚˜ê°‘ë‹ˆë‹¤."
                    ],
                    mantra: "OM TARE TUTTARE TURE MAMA AYUH PUNYE JNANA PUSHTIM KURU SVAHA",
                    audio_query: "White Tara Mantra Long Life"
                },
                normal: {
                    diag: "ì‹¤í–‰ ì „ì˜ ë§ì„¤ì„ â” ì¦‰ê°ì ì¸ ì„±ì·¨",
                    desc: "í•  ì¼ì€ ì•Œì§€ë§Œ ë§ì„¤ì´ê³  ìˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì—ê²Œ í•„ìš”í•œ ê±´ ë” ë§ì€ ê³„íšì´ ì•„ë‹ˆë¼ ë‹¨ í•œ ë²ˆì˜ í–‰ë™ì…ë‹ˆë‹¤.",
                    sutra: "ã€Œë¬´ì†Œì˜ ë¿”ì²˜ëŸ¼ í˜¼ìì„œ ê°€ë¼.ã€ - ìˆ«íƒ€ë‹ˆíŒŒíƒ€",
                    sutra_link_name: "ìˆ«íƒ€ë‹ˆíŒŒíƒ€ ì›ë¬¸ ë³´ê¸°",
                    sutra_query: "Suttanipata Rhinoceros Horn text pdf",
                    prac: "[ë‹¨í˜¸í•œ í–‰ë™] ê³ ë¯¼í•˜ë˜ ì¼ì„ ì§€ê¸ˆ ë‹¹ì¥ 1ë¶„ë§Œ ì‹¤í–‰í•˜ì‹­ì‹œì˜¤.",
                    steps: [
                        "ì§€ê¸ˆ ê°€ì¥ ë¯¸ë£¨ê³  ìˆëŠ” ì¼ í•˜ë‚˜ë¥¼ ì •í•©ë‹ˆë‹¤.",
                        "íƒ€ì´ë¨¸ë¥¼ 5ë¶„ì— ë§ì¶¥ë‹ˆë‹¤.",
                        "ì•„ë¬´ ìƒê° ì—†ì´ ê¸°ê³„ì²˜ëŸ¼ ê·¸ ì¼ì„ ì‹œì‘í•©ë‹ˆë‹¤.",
                        "ì•ŒëŒì´ ìš¸ë¦¬ë©´ ë©ˆì¶”ê³  ì„±ì·¨ê°ì„ ëŠë‚ë‹ˆë‹¤."
                    ],
                    mantra: "OM TARE TUTTARE TURE SVAHA",
                    audio_query: "Green Tara Mantra"
                }
            }
        };

        if (primary === 'Red' && secondary === 'Blue' && intensity > 30) {
            return {
                diag: "ëƒ‰ì •ê³¼ ì—´ì •ì˜ ì¶©ëŒ â” ì™„ì „í•œ í†µí•©ìœ¼ë¡œì˜ ìŠ¹í™”",
                desc: "ì´ì„±ê³¼ ê°ì„± ì‚¬ì´ì—ì„œ ê°ˆë“±í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ ì¶©ëŒì„ ìœµí•©í•˜ë©´ ì§€í˜œì™€ ìë¹„ê°€ í•˜ë‚˜ ëœ ê°€ì¥ ì™„ë²½í•œ ìƒíƒœê°€ ë©ë‹ˆë‹¤.",
                sutra: "ã€Œë²ˆë‡Œê°€ ê³§ ë³´ë¦¬(ê¹¨ë‹¬ìŒ)ë‹¤.ã€ - ìœ ì‹ë¡ ",
                sutra_link_name: "ìœ ì‹ 30ì†¡ ì›ë¬¸ ë³´ê¸°",
                sutra_query: "Vijnaptimatrata text pdf",
                prac: "[í•©ì¼ ëª…ìƒ] ë¶‰ì€ ê¸°ìš´ê³¼ í‘¸ë¥¸ ê¸°ìš´ì´ ë°°ê¼½ ì•„ë˜ì—ì„œ ì„ì…ë‹ˆë‹¤.",
                steps: [
                    "ì˜¤ë¥¸ì†(ì´ì„±)ê³¼ ì™¼ì†(ê°ì„±)ì„ ë¬´ë¦ ìœ„ì— ë‘¡ë‹ˆë‹¤.",
                    "ë‘ ì†ì„ ì²œì²œíˆ ê°€ìŠ´ ì•ìœ¼ë¡œ ëª¨ì•„ í•©ì¥í•©ë‹ˆë‹¤.",
                    "ë‘ ì—ë„ˆì§€ê°€ ë§Œë‚˜ ë³´ë¼ìƒ‰ ë¹›ìœ¼ë¡œ ë³€í•˜ëŠ” ê²ƒì„ ìƒìƒí•©ë‹ˆë‹¤.",
                    "ê·¸ ë¹›ì„ ë‹¨ì „(ë°°ê¼½ ì•„ë˜)ìœ¼ë¡œ ë‚´ë¦½ë‹ˆë‹¤."
                ],
                mantra: "OM AH HUM",
                audio_query: "Om Ah Hum Mantra"
            };
        }

        return isExtreme ? DB[primary].extreme : DB[primary].normal;
    }

    function rgbToHsv(r, g, b) { r/=255,g/=255,b/=255;let max=Math.max(r,g,b),min=Math.min(r,g,b);let h,s,v=max;let d=max-min;s=max==0?0:d/max;if(max==min){h=0}else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6}return[h*360,s,v]; }
    function getMembership(value, target, range=45) { let diff=Math.abs(value-target);if(diff>180)diff=360-diff;if(diff>range)return 0;return 1-(diff/range); }

    function analyzeFuzzy(imageData) {
        const data = imageData.data;
        let scores = { 'Blue':0,'Yellow':0,'Red':0,'Green':0,'White':0 };
        for (let i=0; i<data.length; i+=16) {
            let r=data[i],g=data[i+1],b=data[i+2]; let [h,s,v]=rgbToHsv(r,g,b);
            let whiteScore=0; if(s<0.15 && v>0.8) { whiteScore=(1-s)*v; scores['White']+=whiteScore; }
            if(whiteScore<0.8) { for(let key of ['Red','Blue','Yellow','Green']){ let mem=getMembership(h,BASE_INFO[key].hue); let intensity=mem*s*v; if(intensity>0)scores[key]+=intensity; }}
        }
        let totalScore = Object.values(scores).reduce((a,b)=>a+b,0);

        MANDALA_KEYS.forEach(key => {
            let percent = totalScore > 0 ? (scores[key]/totalScore*100).toFixed(1) : 0;
            let info = BASE_INFO[key];
            let card = document.createElement('div');
            card.className = 'card'; card.style.borderColor = info.color; card.style.gridArea = info.gridArea;
            card.innerHTML = `<div class="direction-label">${info.direction_kr}</div><div class="card-titles"><div class="card-title-kr">${info.sanskrit_kr}</div><div class="card-title-en">${info.wisdom_kr.split('(')[1] ? info.wisdom_kr.split('(')[1].replace(')','') : 'Wisdom'}</div></div><div class="card-value" style="color:${info.color}">${percent}%</div>`;
            mandalaGrid.appendChild(card);
        });

        if (totalScore > 0) {
            let sortedKeys = Object.keys(scores).sort((a,b) => scores[b] - scores[a]);
            let primary = sortedKeys[0];
            let secondary = sortedKeys[1];
            let primaryScore = (scores[primary]/totalScore*100);

            let oracle = getOracleData(primary, secondary, primaryScore);
            let color = BASE_INFO[primary] ? BASE_INFO[primary].color : '#fff';

            // 1. ì§„ë‹¨
            document.getElementById('diag-card').style.borderColor = color;
            document.getElementById('diag-result').innerText = oracle.diag;
            document.getElementById('diag-result').style.color = color;
            document.getElementById('diag-desc').innerText = oracle.desc; 
            diagnosisSection.style.display = 'block';

            // 2. ìˆ˜íŠ¸ë¼ (ê²½ì „ + ë²„íŠ¼)
            document.getElementById('sutra-box').style.borderColor = color;
            document.getElementById('sutra-text').innerText = oracle.sutra;
            document.getElementById('sutra-actions').innerHTML = `
                <a href="https://www.google.com/search?q=${encodeURIComponent(oracle.sutra_query)}" target="_blank" class="action-btn">
                    <span>ğŸ“–</span> ${oracle.sutra_link_name}
                </a>`;

            // 3. íƒ„íŠ¸ë¼ (ìˆ˜í–‰ + ìŠ¤í… ë¦¬ìŠ¤íŠ¸)
            document.getElementById('practice-box').style.borderColor = color;
            document.getElementById('practice-text').innerText = oracle.prac;
            const stepsUl = document.getElementById('practice-steps');
            stepsUl.innerHTML = '';
            oracle.steps.forEach((step, idx) => {
                let li = document.createElement('li');
                li.innerHTML = `<span class="step-num">${idx+1}.</span> ${step}`;
                stepsUl.appendChild(li);
            });

            // 4. ë§ŒíŠ¸ë¼ (ì½”ë“œ + ì˜¤ë””ì˜¤ ë²„íŠ¼)
            document.getElementById('mantra-box').style.borderColor = color;
            document.getElementById('mantra-text').innerText = oracle.mantra;
            document.getElementById('mantra-text').style.color = color;
            document.getElementById('mantra-actions').innerHTML = `
                <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(oracle.audio_query)}" target="_blank" class="action-btn">
                    <span>ğŸ“º</span> YouTube
                </a>
                <a href="https://open.spotify.com/search/${encodeURIComponent(oracle.audio_query)}" target="_blank" class="action-btn">
                    <span>ğŸ§</span> Spotify
                </a>`;

            remedySection.style.display = 'block';
        }
    }
</script>
</body>
</html>
