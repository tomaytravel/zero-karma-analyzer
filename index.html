<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZERO KARMA : FINAL RITUAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+KR:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-green: #00ff9d; --neon-blue: #00ccff; --neon-yellow: #ffcc00;
            --neon-red: #ff0055; --neon-white: #ffffff;
            --dark-bg: #050505; --glass: rgba(20, 20, 20, 0.85);
        }

        body {
            margin: 0; background-color: var(--dark-bg); color: #fff;
            font-family: 'Noto Sans KR', sans-serif; overflow-x: hidden;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; padding: 20px; box-sizing: border-box;
        }

        .bubbles {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at 50% 50%, rgba(0, 255, 157, 0.1) 0%, transparent 60%);
            pointer-events: none;
        }

        h1 {
            font-family: 'Orbitron', sans-serif; font-size: 1.8rem; color: var(--neon-green);
            text-shadow: 0 0 10px var(--neon-green); letter-spacing: 3px; text-align: center; margin-top: 10px;
        }

        .subtitle { font-size: 0.8rem; color: #888; margin-bottom: 30px; text-transform: uppercase; font-family: 'Orbitron', sans-serif; }

        /* ì—…ë¡œë“œ ì„¹ì…˜ */
        .upload-container {
            position: relative; width: 65vw; height: 65vw; max-width: 220px; max-height: 220px;
            display: flex; justify-content: center; align-items: center; margin-bottom: 40px;
        }
        .mantra-ring { position: absolute; width: 100%; height: 100%; animation: spin 25s linear infinite; }
        .seed-syllable {
            width: 68%; height: 68%; border-radius: 50%; background: rgba(255,255,255,0.05);
            backdrop-filter: blur(5px); border: 2px solid var(--neon-green);
            box-shadow: 0 0 25px rgba(0, 255, 157, 0.25); display: flex; flex-direction: column;
            justify-content: center; align-items: center; cursor: pointer; z-index: 10; transition: all 0.3s ease;
            text-align: center;
        }
        .seed-syllable:hover { box-shadow: 0 0 40px rgba(0, 255, 157, 0.4); transform: scale(1.02); }
        .seed-syllable:active { transform: scale(0.95); }
        .seed-icon { font-size: 2.5rem; color: #fff; line-height: 1.2; }
        .upload-hint { font-family: 'Orbitron', sans-serif; font-size: 0.6rem; color: var(--neon-green); margin-top: 8px; letter-spacing: 1px; font-weight: 700; }
        #upload-input { display: none; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .scanning { animation: pulse 1s infinite; }
        @keyframes pulse { 50% { box-shadow: 0 0 50px var(--neon-green); } }

        /* ë§Œë‹¤ë¼ ê·¸ë¦¬ë“œ */
        #mandala-grid {
            display: grid; gap: 15px; margin-bottom: 40px;
            grid-template-areas: ". north ." "west center east" ". south .";
            width: 100%; max-width: 450px;
        }
        .card {
            background: var(--glass); border: 1px solid #333; padding: 15px 10px;
            border-top: 4px solid; display: flex; flex-direction: column;
            align-items: center; text-align: center; position: relative;
            aspect-ratio: 1 / 1; justify-content: space-between;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .direction-label { font-size: 0.55rem; color: #888; letter-spacing: 2px; margin-bottom: auto; font-family: 'Orbitron', sans-serif; }
        .card-titles { margin: auto 0; }
        .card-title-kr { font-size: 0.95rem; font-weight: 700; margin-bottom: 4px; word-break: keep-all;}
        .card-title-en { font-size: 0.65rem; color: #bbb; font-family: 'Orbitron', sans-serif; letter-spacing: 0.5px;}
        .card-value { font-size: 1.2rem; font-weight: bold; margin-top: auto; font-family: 'Orbitron', sans-serif; }
        
        /* ì§„ë‹¨ ë°•ìŠ¤ */
        #diagnosis-section { width: 100%; max-width: 500px; display: none; animation: slideUp 0.8s ease-out; margin-bottom: 30px; }
        .diagnosis-card {
            background: rgba(0,0,0,0.9); border: 2px solid var(--neon-green); padding: 25px 20px;
            text-align: center; box-shadow: 0 0 30px rgba(0, 255, 157, 0.15);
        }
        .diag-header { font-size: 1rem; color: #fff; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 3px; font-family: 'Orbitron', sans-serif;}
        .diag-result { font-size: 1.3rem; font-weight: bold; color: var(--neon-green); word-break: keep-all; line-height: 1.4; }

        /* ì²˜ë°© ì„¹ì…˜ */
        #remedy-section { width: 100%; max-width: 500px; display: none; animation: slideUp 1s ease-out; padding-bottom: 60px; }
        .remedy-box { background: var(--glass); border-left: 4px solid #555; padding: 20px; margin-bottom: 20px; }
        .remedy-label { font-size: 0.85rem; color: #999; margin-bottom: 12px; display: block; font-family: 'Orbitron', sans-serif; letter-spacing: 1px; font-weight: 700;}
        .sutra-text { font-size: 1rem; font-style: italic; color: #ddd; line-height: 1.6; word-break: keep-all;}
        .practice-text { font-size: 1rem; color: #fff; line-height: 1.7; word-break: keep-all; white-space: pre-line;}
        .mantra-box-style { text-align: center; border: 2px dashed var(--neon-green); background: rgba(0, 255, 157, 0.05);}
        .mantra-text { font-family: 'Orbitron', monospace; color: var(--neon-green); font-size: 1.1rem; letter-spacing: 1.5px; }

        /* DEEP DIVE ë²„íŠ¼ ë° ì»¨í…ì¸  */
        #deep-dive-trigger { width: 100%; max-width: 500px; text-align: center; display: none; margin-bottom: 30px; }
        .neon-btn {
            background: transparent; border: 2px solid var(--neon-green); color: var(--neon-green);
            padding: 15px 30px; font-family: 'Orbitron', sans-serif; font-size: 1rem; cursor: pointer;
            letter-spacing: 2px; transition: all 0.3s; position: relative; overflow: hidden;
        }
        .neon-btn:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 20px var(--neon-green); }
        
        #deep-dive-content { width: 100%; max-width: 500px; display: none; padding-bottom: 100px; }
        .deep-box {
            background: rgba(10, 10, 10, 0.95); border: 1px solid #444; padding: 20px; margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-radius: 5px;
        }
        .deep-title { color: #fff; font-size: 1.1rem; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; font-family: 'Orbitron', sans-serif; }
        .deep-title span { margin-right: 10px; }
        .step-list { list-style: none; padding: 0; margin: 0; text-align: left; }
        .step-list li { margin-bottom: 12px; font-size: 0.95rem; line-height: 1.6; color: #ccc; }
        .step-list li strong { color: var(--neon-green); margin-right: 5px; }
        
        .link-btn {
            display: inline-block; background: #222; color: #aaa; text-decoration: none;
            padding: 10px 15px; margin-right: 10px; font-size: 0.8rem; border: 1px solid #444; transition: all 0.2s;
            margin-top: 10px; font-family: 'Noto Sans KR', sans-serif;
        }
        .link-btn:hover { border-color: var(--neon-green); color: #fff; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="bubbles"></div>
    <h1>ZERO KARMA</h1>
    <div class="subtitle">Multi-Dimensional Ritual</div>

    <div class="upload-container">
        <svg class="mantra-ring" viewBox="0 0 300 300">
            <path id="circlePath" d="M 150, 150 m -120, 0 a 120,120 0 0,1 240,0 a 120,120 0 0,1 -240,0" fill="none"/>
            <text fill="#00ff9d" font-size="13" font-family="monospace" letter-spacing="3.5" font-weight="bold">
                <textPath href="#circlePath">OM TARE TUTTARE TURE SVAHA à¥ OM TARE TUTTARE TURE SVAHA à¥</textPath>
            </text>
        </svg>
        <label for="upload-input" class="seed-syllable" id="drop-zone">
            <span class="seed-icon">ğ‘–ğ‘–¾</span>
            <span class="upload-hint">CLICK TO UPLOAD IMAGE</span>
        </label>
        <input type="file" id="upload-input" accept="image/*">
    </div>

    <div id="mandala-grid"></div>

    <div id="diagnosis-section">
        <div class="diagnosis-card" id="diag-card">
            <div class="diag-header">Oracle Diagnosis</div>
            <div class="diag-result" id="diag-result"></div>
        </div>
    </div>

    <div id="remedy-section">
        <div class="remedy-box" id="sutra-box">
            <span class="remedy-label">â… . SUTRA WISDOM (ê²½ì „ì˜ ì§€í˜œ)</span>
            <div class="sutra-text" id="sutra-text"></div>
        </div>
        <div class="remedy-box" id="practice-box">
            <span class="remedy-label">â…¡. TANTRA PRACTICE (íƒ„íŠ¸ë¼ ìˆ˜í–‰)</span>
            <div class="practice-text" id="practice-text"></div>
        </div>
        <div class="remedy-box mantra-box-style" id="mantra-box">
            <span class="remedy-label" style="margin-bottom: 15px;">â…¢. MANTRA CODE (ì§„ì–¸)</span>
            <div class="mantra-text" id="mantra-text"></div>
        </div>
    </div>

    <div id="deep-dive-trigger">
        <button class="neon-btn" id="btn-deep">DEEP DIVE : START RITUAL</button>
    </div>

    <div id="deep-dive-content">
        <div class="deep-box" style="border-left: 3px solid #ffcc00;">
            <div class="deep-title"><span>ğŸ“–</span> SACRED TEXTS (ì†Œì˜ê²½ì „)</div>
            <div style="color:#ccc; font-size:0.9rem; margin-bottom:10px;" id="deep-sutra-desc"></div>
            <a href="#" target="_blank" class="link-btn" id="link-sutra">ì›ë¬¸ ê²€ìƒ‰ (Google)</a>
        </div>

        <div class="deep-box" style="border-left: 3px solid #00ccff;">
            <div class="deep-title"><span>ğŸ§˜â€â™‚ï¸</span> STEP-BY-STEP MEDITATION</div>
            <ul class="step-list" id="deep-steps">
                </ul>
        </div>

        <div class="deep-box" style="border-left: 3px solid #ff0055;">
            <div class="deep-title"><span>ğŸ§</span> SONIC DRIVE (ë§ŒíŠ¸ë¼ ì²­ì·¨)</div>
            <div style="color:#ccc; font-size:0.9rem; margin-bottom:10px;">ì²˜ë°©ëœ ë§ŒíŠ¸ë¼ì˜ íŒŒë™ì„ ì§ì ‘ ë“¤ìœ¼ë©° ìˆ˜í–‰í•˜ì‹­ì‹œì˜¤.</div>
            <a href="#" target="_blank" class="link-btn" id="link-youtube">YouTube Listening</a>
            <a href="#" target="_blank" class="link-btn" id="link-spotify">Spotify Search</a>
        </div>
    </div>

    <canvas id="canvas" style="display:none;"></canvas>

<script>
    const uploadInput = document.getElementById('upload-input');
    const dropZone = document.getElementById('drop-zone');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // UI Refs
    const mandalaGrid = document.getElementById('mandala-grid');
    const diagnosisSection = document.getElementById('diagnosis-section');
    const remedySection = document.getElementById('remedy-section');
    const deepTrigger = document.getElementById('deep-dive-trigger');
    const deepContent = document.getElementById('deep-dive-content');
    const btnDeep = document.getElementById('btn-deep');

    // ê¸°ë³¸ ë§Œë‹¤ë¼ ì •ë³´
    const BASE_INFO = {
        'White': { color: 'var(--neon-white)', gridArea: 'center', direction_kr: 'ì¤‘ì•™ (CENTER)', sanskrit_kr: 'ë¹„ë¡œìë‚˜ë¶ˆ', wisdom_kr: 'ë²•ê³„ì²´ì„±ì§€', hue: 0 },
        'Blue':  { color: 'var(--neon-blue)',  gridArea: 'east',   direction_kr: 'ë™ë°© (EAST)',   sanskrit_kr: 'ì•„ì´‰ë¶ˆ',     wisdom_kr: 'ëŒ€ì›ê²½ì§€',   hue: 240 },
        'Yellow':{ color: 'var(--neon-yellow)',gridArea: 'south',  direction_kr: 'ë‚¨ë°© (SOUTH)',  sanskrit_kr: 'ë³´ìƒë¶ˆ',     wisdom_kr: 'í‰ë“±ì„±ì§€',   hue: 60 },
        'Red':   { color: 'var(--neon-red)',   gridArea: 'west',   direction_kr: 'ì„œë°© (WEST)',   sanskrit_kr: 'ì•„ë¯¸íƒ€ë¶ˆ',   wisdom_kr: 'ë¬˜ê´€ì°°ì§€',   hue: 0 },
        'Green': { color: 'var(--neon-green)', gridArea: 'north',  direction_kr: 'ë¶ë°© (NORTH)',  sanskrit_kr: 'ë¶ˆê³µì„±ì·¨ë¶ˆ', wisdom_kr: 'ì„±ì†Œì‘ì§€',   hue: 120 }
    };
    const MANDALA_KEYS = ['Green', 'Red', 'White', 'Blue', 'Yellow'];

    // ë²„íŠ¼ ì´ë²¤íŠ¸
    btnDeep.addEventListener('click', () => {
        deepContent.style.display = 'block';
        btnDeep.style.display = 'none'; // ë²„íŠ¼ ìˆ¨ê¹€
        deepContent.scrollIntoView({ behavior: 'smooth' });
    });

    uploadInput.addEventListener('change', handleFile);

    function handleFile(e) {
        const file = e.target.files[0];
        if (!file) return;
        resetUI();
        dropZone.classList.add('scanning'); 
        dropZone.querySelector('.seed-icon').innerHTML = "à¥"; 
        dropZone.querySelector('.upload-hint').innerHTML = "ANALYZING...";

        const img = new Image();
        img.onload = () => {
            const MAX_SIZE = 500;
            let w = img.width, h = img.height;
            if (w > h) { if (w > MAX_SIZE) { h *= MAX_SIZE/w; w = MAX_SIZE; } } 
            else { if (h > MAX_SIZE) { w *= MAX_SIZE/h; h = MAX_SIZE; } }
            canvas.width = w; canvas.height = h; ctx.drawImage(img, 0, 0, w, h);
            setTimeout(() => { 
                analyzeFuzzy(ctx.getImageData(0,0,w,h)); 
                dropZone.classList.remove('scanning'); 
                dropZone.querySelector('.seed-icon').innerHTML = "ğ‘–ğ‘–¾"; 
                dropZone.querySelector('.upload-hint').innerHTML = "CLICK TO UPLOAD IMAGE";
            }, 800);
        };
        img.src = URL.createObjectURL(file);
    }

    function resetUI() {
        mandalaGrid.innerHTML = '';
        diagnosisSection.style.display = 'none';
        remedySection.style.display = 'none';
        deepTrigger.style.display = 'none';
        deepContent.style.display = 'none';
        btnDeep.style.display = 'inline-block';
    }

    // --- í¼ì§€ ë¡œì§ & ì˜¤ë¼í´ ë°ì´í„°ë² ì´ìŠ¤ (ë°œìŒ ìˆ˜ì • ë°˜ì˜) ---
    function getOracleData(primary, secondary, intensity) {
        const isExtreme = intensity > 50; 
        
        const DB = {
            'White': {
                extreme: {
                    diag: "ì••ë„ì ì¸ í˜¼ë€ / í˜¹ì€ ë¬´í•œí•œ ê³µí—ˆ",
                    sutra: "ã€Œí—ˆê³µì€ ë¶€ì„œì§€ì§€ ì•Šìœ¼ë‚˜, ë§Œìƒì€ í—ˆê³µ ì†ì—ì„œ ìƒê²¨ë‚˜ê³  ì‚¬ë¼ì§„ë‹¤.ã€ - ëŠ¥ì—„ê²½",
                    prac: "[ê³µì„± ì²´í—˜] ì‹œì„ ì„ í•˜ëŠ˜ì— ê³ ì •í•˜ê³  ë‹¨í˜¸í•˜ê²Œ 'íŒŸ(PHAT)!' í•˜ê³  ì™¸ì³ ìƒê°ì„ ëŠìœ¼ì‹­ì‹œì˜¤.",
                    mantra: "OM VAIROCANA MALA SVAHA",
                    // Deep Dive Data
                    deep_sutra_key: "Surangama Sutra text",
                    deep_sutra_desc: "ëŠ¥ì—„ê²½(Shurangama Sutra)ì€ ë§ìƒì„ ê¹¨ëœ¨ë¦¬ëŠ” ê°€ì¥ ê°•ë ¥í•œ ê²½ì „ì…ë‹ˆë‹¤.",
                    deep_steps: [
                        "í¸ì•ˆí•˜ê²Œ ì•‰ì•„ ëˆˆì„ ë°˜ì¯¤ ëœ¹ë‹ˆë‹¤.",
                        "ëˆˆì•ì˜ í—ˆê³µì„ ì‘ì‹œí•˜ë©° 'ì´ ìƒê°ì€ ì–´ë””ì„œ ì™”ëŠ”ê°€?' ì§ˆë¬¸í•©ë‹ˆë‹¤.",
                        "ìƒê°ì´ ê¼¬ë¦¬ë¥¼ ë¬¼ë©´ ë°•ìˆ˜ë¥¼ ì¹˜ë“¯ ê°•í•˜ê²Œ 'íŒŸ(PHAT)!' í•˜ê³  ì™¸ì¹©ë‹ˆë‹¤.",
                        "ì†Œë¦¬ê°€ ì‚¬ë¼ì§„ ì§í›„ì˜ í…… ë¹ˆ ì¹¨ë¬µ(Gap)ì„ 1ë¶„ê°„ ê´€ì°°í•˜ì‹­ì‹œì˜¤."
                    ],
                    deep_audio_key: "Vairocana Mantra chanting"
                },
                normal: {
                    diag: "ìˆœìˆ˜í•œ ì ì¬ë ¥ / ë°±ì§€ ìƒíƒœ",
                    sutra: "ã€Œë³¸ë˜ ë§ˆìŒì—ëŠ” í•œ ë¬¼ê±´ë„ ì—†ë‹¤.ã€ - ìœ¡ì¡°ë‹¨ê²½",
                    prac: "[í˜¸í¡ ê´€ì°°] ë‹¨ìˆœíˆ ë“¤ì–´ì˜¤ê³  ë‚˜ê°€ëŠ” ìˆ¨ì˜ ê°ê°ë§Œ 10ë²ˆ ì„¸ì‹­ì‹œì˜¤.",
                    mantra: "OM VAIROCANA HUM",
                    deep_sutra_key: "Platform Sutra text",
                    deep_sutra_desc: "ìœ¡ì¡°ë‹¨ê²½(Platform Sutra)ì€ ë³¸ë˜ ì²­ì •í•œ ë§ˆìŒì„ ì§ê´€í•˜ê²Œ í•©ë‹ˆë‹¤.",
                    deep_steps: [
                        "ì½”ëì— ì˜ì‹ì„ ì§‘ì¤‘í•©ë‹ˆë‹¤.",
                        "ìˆ¨ì´ ë“¤ì–´ì˜¬ ë•Œ 'í•˜ë‚˜', ë‚˜ê°ˆ ë•Œ 'ë‘˜'ì„ ì…‰ë‹ˆë‹¤.",
                        "10ê¹Œì§€ ì„¸ê³  ë‹¤ì‹œ 1ë¡œ ëŒì•„ì˜µë‹ˆë‹¤.",
                        "ìˆ«ìë¥¼ ë†“ì¹˜ë©´ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤."
                    ],
                    deep_audio_key: "Maha Vairochana Mantra"
                }
            },
            'Blue': {
                extreme: {
                    diag: "í­ë°œ ì§ì „ì˜ ë¶„ë…¸ / ì°¨ê°€ìš´ í˜ì˜¤",
                    sutra: "ã€Œë¶„ë…¸ë¥¼ ë‹¤ìŠ¤ë¦¬ì§€ ëª»í•˜ëŠ” ìëŠ” ë…ì‚¬ë¥¼ í’ˆì— ì•ˆê³  ìëŠ” ê²ƒê³¼ ê°™ë‹¤.ã€ - ì…ë³´ë¦¬í–‰ë¡ ",
                    prac: "[ë°”ì¦ˆë¼ ì •í™”] ì‹¬ì¥ì˜ í‘¸ë¥¸ 'í›”' ìê°€ ë¶ˆê¸¸ì„ ë¬¼ë¡œ ë°”ê¾¸ëŠ” ìƒìƒì„ í•˜ì‹­ì‹œì˜¤.",
                    mantra: "OM VAJRA CHANDA MAHA ROSHANA HUM PHAT",
                    deep_sutra_key: "Bodhicharyavatara text",
                    deep_sutra_desc: "ì…ë³´ë¦¬í–‰ë¡ (Way of the Bodhisattva) ì œ6ì¥ 'ì¸ìš•í’ˆ'ì„ ì½ìœ¼ì‹­ì‹œì˜¤.",
                    deep_steps: [
                        "ìì‹ ì˜ ì‹¬ì¥ì— ë¶ˆíƒ€ëŠ” ë¶‰ì€ ê³µì´ ìˆë‹¤ê³  ìƒìƒí•©ë‹ˆë‹¤ (ë¶„ë…¸).",
                        "ì •ìˆ˜ë¦¬ì—ì„œ ì‹œì›í•œ í‘¸ë¥¸ ê°ë¡œìˆ˜ê°€ ìŸì•„ì ¸ ë‚´ë¦½ë‹ˆë‹¤.",
                        "ë¬¼ì´ ì‹¬ì¥ì— ë‹¿ëŠ” ìˆœê°„ 'ì¹˜ì´ìµ' ì†Œë¦¬ì™€ í•¨ê»˜ ë¶ˆì´ êº¼ì§‘ë‹ˆë‹¤.",
                        "ëª¸ ë°–ìœ¼ë¡œ ê²€ì€ ì—°ê¸°ê°€ ë¹ ì ¸ë‚˜ê°€ëŠ” ê²ƒì„ ì§€ì¼œë³´ì‹­ì‹œì˜¤."
                    ],
                    deep_audio_key: "Acala Mantra Budong Myoo"
                },
                normal: {
                    diag: "ëƒ‰ì² í•œ ì´ì„± / ëª…ë£Œí•œ ê±°ìš¸",
                    sutra: "ã€Œê±°ìš¸ì€ ì‚¬ë¬¼ì„ ë¹„ì¶”ë˜ í”ì ì„ ë‚¨ê¸°ì§€ ì•ŠëŠ”ë‹¤.ã€ - ëŒ€ì›ê²½ì§€ì†¡",
                    prac: "[ê°ê´€í™”] ê°ì •ì„ ëº€ ì‚¬ì‹¤(Fact)ë§Œ ì¢…ì´ì— ì ì–´ë³´ì‹­ì‹œì˜¤.",
                    mantra: "OM AKSHOBHYA VAJRA SVAHA",
                    deep_sutra_key: "Vimalakirti Sutra wisdom",
                    deep_sutra_desc: "ìœ ë§ˆê²½(Vimalakirti Sutra)ì˜ ë¶ˆì´ë²•ë¬¸ì„ í†µí•´ ë¶„ë³„ì„ ëŠìœ¼ì‹­ì‹œì˜¤.",
                    deep_steps: [
                        "ìì‹ ì„ íˆ¬ëª…í•œ ê±°ìš¸ì´ë¼ê³  ìƒìƒí•©ë‹ˆë‹¤.",
                        "ë– ì˜¤ë¥´ëŠ” ê°ì •ì„ ê±°ìš¸ì— ë¹„ì¹œ ì˜ìƒìœ¼ë¡œ ë°”ë¼ë´…ë‹ˆë‹¤.",
                        "'ì´ê²ƒì€ ë‚´ ê²ƒì´ ì•„ë‹ˆë‹¤'ë¼ê³  ë˜ë‡ë‹ˆë‹¤.",
                        "ì˜ìƒì´ ì‚¬ë¼ì§„ í›„ ê±°ìš¸ì˜ ê¹¨ë—í•¨ë§Œ ëŠë‚ë‹ˆë‹¤."
                    ],
                    deep_audio_key: "Akshobhya Buddha Mantra"
                }
            },
            'Yellow': {
                extreme: {
                    diag: "ë¹„ëŒ€í•œ ìì•„ / ì˜¤ë§Œê³¼ ê³ ì§‘",
                    sutra: "ã€Œë‚˜ë¼ëŠ” ìƒ(Ego)ì´ ìˆìœ¼ë©´ ë³´ì‚´ì´ ì•„ë‹ˆë‹¤.ã€ - ê¸ˆê°•ê²½",
                    prac: "[ì˜¤ì²´íˆ¬ì§€] ìì¡´ì‹¬ì„ ë•…ì— ë‚´ë ¤ë†“ëŠ” ì ˆì„ 3ë²ˆ í•˜ì‹­ì‹œì˜¤.",
                    mantra: "OM RATNASAMBHAVA TRAM",
                    deep_sutra_key: "Diamond Sutra text",
                    deep_sutra_desc: "ê¸ˆê°•ê²½(Diamond Sutra)ì€ ì—ê³ ë¥¼ ë¶€ìˆ˜ëŠ” ê°€ì¥ ê°•ë ¥í•œ ë§ì¹˜ì…ë‹ˆë‹¤.",
                    deep_steps: [
                        "ì¼ì–´ì„œì„œ í•©ì¥í•˜ê³  ë‚´ ì•ˆì˜ ì˜¤ë§Œí•¨ì„ ì¸ì •í•©ë‹ˆë‹¤.",
                        "ì²œì²œíˆ ë¬´ë¦, íŒ”ê¿ˆì¹˜, ì´ë§ˆë¥¼ ë•…ì— ëŒ‘ë‹ˆë‹¤ (ì˜¤ì²´íˆ¬ì§€).",
                        "ë•…ì˜ ë‚®ì€ ê³³ì— ë¨¸ë¦¬ë¥¼ ëŒ€ê³  'ë‚˜ëŠ” í™ìœ¼ë¡œ ëŒì•„ê°„ë‹¤' ìƒê°í•©ë‹ˆë‹¤.",
                        "ì¼ì–´ë‚˜ë©° ìƒˆë¡œìš´ ê²¸ì†í•œ ìì•„ë¡œ ë‹¤ì‹œ íƒœì–´ë‚©ë‹ˆë‹¤."
                    ],
                    deep_audio_key: "Ratnasambhava Mantra"
                },
                normal: {
                    diag: "ë‚´ë©´ì˜ í’ìš” / ê±´ê°•í•œ ìì¡´ê°",
                    sutra: "ã€Œì§„í™ ì†ì—ì„œë„ ì—°ê½ƒì€ í”¼ì–´ë‚œë‹¤.ã€ - ë²•í™”ê²½",
                    prac: "[ë³´ì‹œ ìˆ˜í–‰] ì˜¤ëŠ˜ íƒ€ì¸ì—ê²Œ ì‘ì€ ì¹œì ˆì„ ë² í‘¸ì‹­ì‹œì˜¤.",
                    mantra: "OM RATNA SURYA SVAHA",
                    deep_sutra_key: "Lotus Sutra text",
                    deep_sutra_desc: "ë²•í™”ê²½(Lotus Sutra)ì€ ë‹¹ì‹ ì´ ë³¸ë˜ ë¶€ì²˜ì„ì„ ì¼ê¹¨ì›Œì¤ë‹ˆë‹¤.",
                    deep_steps: [
                        "ê°€ìŠ´ ì¤‘ì•™ì— í™©ê¸ˆìƒ‰ ë³´ì„ì´ ë¹›ë‚œë‹¤ê³  ìƒìƒí•©ë‹ˆë‹¤.",
                        "ìˆ¨ì„ ë‚´ì‰´ ë•Œë§ˆë‹¤ í™©ê¸ˆë¹›ì´ ì£¼ë³€ìœ¼ë¡œ í¼ì ¸ë‚˜ê°‘ë‹ˆë‹¤.",
                        "ê·¸ ë¹›ì´ ë‹¿ëŠ” ëª¨ë“  ì‚¬ëŒì—ê²Œ í’ìš”ë¥¼ ì„ ë¬¼í•©ë‹ˆë‹¤.",
                        "'ë‚˜ëŠ” ì´ë¯¸ ì¶©ë¶„í•˜ë‹¤'ë¼ê³  3ë²ˆ í™•ì–¸í•©ë‹ˆë‹¤."
                    ],
                    deep_audio_key: "Yellow Jambhala Mantra"
                }
            },
            'Red': {
                extreme: {
                    diag: "íƒ€ì˜¤ë¥´ëŠ” ê°ˆë§ / ë©ˆì¶œ ìˆ˜ ì—†ëŠ” ì§‘ì°©",
                    sutra: "ã€Œì• ìš•ì€ íšƒë¶ˆì„ ì¡ê³  ë°”ëŒì„ ê±°ìŠ¬ëŸ¬ ê°€ëŠ” ê²ƒê³¼ ê°™ë‹¤.ã€ - ì‚¬ì‹­ì´ì¥ê²½",
                    prac: "[ë¶€ì •ê´€] ì´ ìš•ë§ì˜ ëŒ€ìƒì´ ë¼ˆì™€ ì‚´ì¼ ë¿ì„ì„ ì§ì‹œí•˜ì‹­ì‹œì˜¤.",
                    mantra: "OM AMITABHA HRIH SVAHA",
                    deep_sutra_key: "Sutra of Forty-two Chapters",
                    deep_sutra_desc: "ì‚¬ì‹­ì´ì¥ê²½ì€ ìš•ë§ì˜ ì‹¤ì²´ë¥¼ ì ë‚˜ë¼í•˜ê²Œ ë³´ì—¬ì¤ë‹ˆë‹¤.",
                    deep_steps: [
                        "ì§‘ì°©í•˜ê³  ìˆëŠ” ëŒ€ìƒ(ì‚¬ëŒ/ë¬¼ê±´)ì„ ë– ì˜¬ë¦½ë‹ˆë‹¤.",
                        "ê·¸ ëŒ€ìƒì˜ í”¼ë¶€ê°€ ë²—ê²¨ì§€ê³  ë¼ˆë§Œ ë‚¨ì€ ëª¨ìŠµì„ ìƒìƒí•©ë‹ˆë‹¤ (í•´ê³¨).",
                        "ê·¸ ë¼ˆê°€ ê°€ë£¨ê°€ ë˜ì–´ ë°”ëŒì— í©ì–´ì§€ëŠ” ê²ƒì„ ë´…ë‹ˆë‹¤.",
                        "ë¶ˆíƒ€ëŠ” ë§ˆìŒì´ ì¬ê°€ ë˜ì–´ ì°¨ê°‘ê²Œ ì‹ëŠ” ê²ƒì„ ëŠë‚ë‹ˆë‹¤."
                    ],
                    deep_audio_key: "Amitabha Buddha Mantra Hrih"
                },
                normal: {
                    diag: "ë”°ëœ»í•œ ìë¹„ / ì¸ê°„ì ì¸ ë§¤ë ¥",
                    sutra: "ã€Œìë¹„ì‹¬ì€ ì ì„ ì¹œêµ¬ë¡œ ë§Œë“¤ê³ , ë…ì„ ì•½ìœ¼ë¡œ ë°”ê¾¼ë‹¤.ã€ - ìë¹„ê²½",
                    prac: "[í†µë Œ ìˆ˜í–‰] ì„¸ìƒì˜ ê³ í†µì„ ë“¤ì´ë§ˆì‹œê³ , í–‰ë³µì„ ë‚´ì‰¬ì‹­ì‹œì˜¤.",
                    mantra: "OM ARO LIK SVAHA",
                    deep_sutra_key: "Metta Sutta text",
                    deep_sutra_desc: "ìë¹„ê²½(Metta Sutta)ì€ ì‚¬ë‘ì˜ ì—ë„ˆì§€ë¥¼ í™•ì¥ì‹œí‚µë‹ˆë‹¤.",
                    deep_steps: [
                        "ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒì´ë‚˜ ê·€ì—¬ìš´ ë™ë¬¼ì„ ë– ì˜¬ë¦½ë‹ˆë‹¤.",
                        "ê²€ì€ ì—°ê¸°(ê·¸ë“¤ì˜ ê³ í†µ)ë¥¼ ë“¤ì´ë§ˆì…” ë‚´ ì‹¬ì¥ì—ì„œ íƒœì›ë‹ˆë‹¤.",
                        "í•˜ì–€ ë¹›(ë‚˜ì˜ í–‰ë³µ)ì„ ë‚´ì‰¬ë©° ê·¸ë“¤ì—ê²Œ ë³´ëƒ…ë‹ˆë‹¤.",
                        "ì´ ëŒ€ìƒì„ ì‹«ì–´í•˜ëŠ” ì‚¬ëŒì—ê²Œê¹Œì§€ í™•ì¥í•©ë‹ˆë‹¤."
                    ],
                    deep_audio_key: "Guanyin Mantra Compassion"
                }
            },
            'Green': {
                extreme: {
                    diag: "ê·¹ì‹¬í•œ ë¶ˆì•ˆ / ì«“ê¸°ëŠ” ë“¯í•œ ì´ˆì¡°í•¨",
                    sutra: "ã€Œê³¼ê±°ëŠ” ì§€ë‚˜ê°”ê³  ë¯¸ë˜ëŠ” ì˜¤ì§€ ì•Šì•˜ë‹¤. ì˜¤ì§ ì§€ê¸ˆë¿ì´ë‹¤.ã€ - ì•„í•¨ê²½",
                    prac: "[ê·¸ë¼ìš´ë”©] ì‹ ë°œì„ ë²—ê³  ë§¨ë°œë¡œ ë•…ì„ ë”›ê³  ê±¸ìœ¼ì‹­ì‹œì˜¤.",
                    mantra: "OM TARE TUTTARE TURE MAMA AYUH PUNYE JNANA PUSHTIM KURU SVAHA",
                    deep_sutra_key: "Heart Sutra text",
                    deep_sutra_desc: "ë°˜ì•¼ì‹¬ê²½(Heart Sutra)ì€ ë¶ˆì•ˆì˜ ì‹¤ì²´ê°€ ì—†ìŒì„ ì•Œë ¤ì¤ë‹ˆë‹¤.",
                    deep_steps: [
                        "ì¼ì–´ì„œì„œ ë°œë°”ë‹¥ì— ì˜ì‹ì„ ë‘¡ë‹ˆë‹¤.",
                        "ì˜¤ë¥¸ë°œì„ ë“¤ ë•Œ 'ë“¦', ë†“ì„ ë•Œ 'ë†“ìŒ'ì„ ì•Œì•„ì°¨ë¦½ë‹ˆë‹¤.",
                        "ì•„ì£¼ ì²œì²œíˆ ë°© ì•ˆì„ ê±·ìŠµë‹ˆë‹¤.",
                        "ë¨¸ë¦¬ì˜ ì—´ê¸°ê°€ ë°œë°”ë‹¥ìœ¼ë¡œ ë‚´ë ¤ê°€ ë•…ìœ¼ë¡œ ë¹ ì ¸ë‚˜ê°‘ë‹ˆë‹¤."
                    ],
                    deep_audio_key: "White Tara Mantra Long Life"
                },
                normal: {
                    diag: "ì„±ì·¨ì˜ ë™ë ¥ / ì‹¤í–‰í•˜ëŠ” í˜",
                    sutra: "ã€Œë¬´ì†Œì˜ ë¿”ì²˜ëŸ¼ í˜¼ìì„œ ê°€ë¼.ã€ - ìˆ«íƒ€ë‹ˆíŒŒíƒ€",
                    prac: "[ë‹¨í˜¸í•œ í–‰ë™] ê³ ë¯¼í•˜ë˜ ì¼ì„ ì§€ê¸ˆ ë‹¹ì¥ 1ë¶„ë§Œ ì‹¤í–‰í•˜ì‹­ì‹œì˜¤.",
                    mantra: "OM TARE TUTTARE TURE SVAHA",
                    deep_sutra_key: "Suttanipata Rhinoceros Horn",
                    deep_sutra_desc: "ìˆ«íƒ€ë‹ˆíŒŒíƒ€(Sutta Nipata)ëŠ” í™€ë¡œ ì„œëŠ” ìš©ê¸°ë¥¼ ì¤ë‹ˆë‹¤.",
                    deep_steps: [
                        "ì§€ê¸ˆ ê°€ì¥ ë¯¸ë£¨ê³  ìˆëŠ” ì¼ í•˜ë‚˜ë¥¼ ì •í•©ë‹ˆë‹¤.",
                        "íƒ€ì´ë¨¸ë¥¼ 5ë¶„ì— ë§ì¶¥ë‹ˆë‹¤.",
                        "ì•„ë¬´ ìƒê° ì—†ì´ ê¸°ê³„ì²˜ëŸ¼ ê·¸ ì¼ì„ ì‹œì‘í•©ë‹ˆë‹¤.",
                        "ì•ŒëŒì´ ìš¸ë¦¬ë©´ ë©ˆì¶”ê³  ì„±ì·¨ê°ì„ ëŠë‚ë‹ˆë‹¤."
                    ],
                    deep_audio_key: "Green Tara Mantra"
                }
            }
        };

        if (primary === 'Red' && secondary === 'Blue' && intensity > 30) {
            return {
                diag: "ëƒ‰ì •ê³¼ ì—´ì •ì˜ ì¶©ëŒ / ë‚´ë¶€ ê°ˆë“±",
                sutra: "ã€Œë²ˆë‡Œê°€ ê³§ ë³´ë¦¬(ê¹¨ë‹¬ìŒ)ë‹¤.ã€ - ìœ ì‹ë¡ ",
                prac: "[í•©ì¼ ëª…ìƒ] ë¶‰ì€ ê¸°ìš´ê³¼ í‘¸ë¥¸ ê¸°ìš´ì´ ë°°ê¼½ ì•„ë˜ì—ì„œ ì„ì…ë‹ˆë‹¤.",
                mantra: "OM AH HUM",
                deep_sutra_key: "Vijnaptimatrata text",
                deep_sutra_desc: "ìœ ì‹ë¡ ì€ ë§ˆìŒì˜ ì‘ìš© ì›ë¦¬ë¥¼ ì„¤ëª…í•´ ì¤ë‹ˆë‹¤.",
                deep_steps: [
                    "ì˜¤ë¥¸ì†(ì´ì„±)ê³¼ ì™¼ì†(ê°ì„±)ì„ ë¬´ë¦ ìœ„ì— ë‘¡ë‹ˆë‹¤.",
                    "ë‘ ì†ì„ ì²œì²œíˆ ê°€ìŠ´ ì•ìœ¼ë¡œ ëª¨ì•„ í•©ì¥í•©ë‹ˆë‹¤.",
                    "ë‘ ì—ë„ˆì§€ê°€ ë§Œë‚˜ ë³´ë¼ìƒ‰ ë¹›ìœ¼ë¡œ ë³€í•˜ëŠ” ê²ƒì„ ìƒìƒí•©ë‹ˆë‹¤.",
                    "ê·¸ ë¹›ì„ ë‹¨ì „(ë°°ê¼½ ì•„ë˜)ìœ¼ë¡œ ë‚´ë¦½ë‹ˆë‹¤."
                ],
                deep_audio_key: "Om Ah Hum Mantra"
            };
        }

        return isExtreme ? DB[primary].extreme : DB[primary].normal;
    }

    function rgbToHsv(r, g, b) { r/=255,g/=255,b/=255;let max=Math.max(r,g,b),min=Math.min(r,g,b);let h,s,v=max;let d=max-min;s=max==0?0:d/max;if(max==min){h=0}else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6}return[h*360,s,v]; }
    function getMembership(value, target, range=45) { let diff=Math.abs(value-target);if(diff>180)diff=360-diff;if(diff>range)return 0;return 1-(diff/range); }

    function analyzeFuzzy(imageData) {
        const data = imageData.data;
        let scores = { 'Blue':0,'Yellow':0,'Red':0,'Green':0,'White':0 };
        for (let i=0; i<data.length; i+=16) {
            let r=data[i],g=data[i+1],b=data[i+2]; let [h,s,v]=rgbToHsv(r,g,b);
            let whiteScore=0; if(s<0.15 && v>0.8) { whiteScore=(1-s)*v; scores['White']+=whiteScore; }
            if(whiteScore<0.8) { for(let key of ['Red','Blue','Yellow','Green']){ let mem=getMembership(h,BASE_INFO[key].hue); let intensity=mem*s*v; if(intensity>0)scores[key]+=intensity; }}
        }
        let totalScore = Object.values(scores).reduce((a,b)=>a+b,0);

        // Render Mandala
        MANDALA_KEYS.forEach(key => {
            let percent = totalScore > 0 ? (scores[key]/totalScore*100).toFixed(1) : 0;
            let info = BASE_INFO[key];
            let card = document.createElement('div');
            card.className = 'card'; card.style.borderColor = info.color; card.style.gridArea = info.gridArea;
            card.innerHTML = `<div class="direction-label">${info.direction_kr}</div><div class="card-titles"><div class="card-title-kr">${info.sanskrit_kr}</div><div class="card-title-en">${info.wisdom_kr.split('(')[1] ? info.wisdom_kr.split('(')[1].replace(')','') : 'Wisdom'}</div></div><div class="card-value" style="color:${info.color}">${percent}%</div>`;
            mandalaGrid.appendChild(card);
        });

        // Oracle Logic
        if (totalScore > 0) {
            let sortedKeys = Object.keys(scores).sort((a,b) => scores[b] - scores[a]);
            let primary = sortedKeys[0];
            let secondary = sortedKeys[1];
            let primaryScore = (scores[primary]/totalScore*100);

            let oracle = getOracleData(primary, secondary, primaryScore);
            let color = BASE_INFO[primary] ? BASE_INFO[primary].color : '#fff';

            // Diagnosis
            document.getElementById('diag-card').style.borderColor = color;
            document.getElementById('diag-result').innerText = oracle.diag;
            document.getElementById('diag-result').style.color = color;
            diagnosisSection.style.display = 'block';

            // Initial Remedy
            document.getElementById('sutra-box').style.borderColor = color;
            document.getElementById('sutra-text').innerText = oracle.sutra;
            document.getElementById('practice-box').style.borderColor = color;
            document.getElementById('practice-text').innerText = oracle.prac;
            document.getElementById('mantra-box').style.borderColor = color;
            document.getElementById('mantra-text').innerText = oracle.mantra;
            document.getElementById('mantra-text').style.color = color;
            remedySection.style.display = 'block';

            // *** DEEP DIVE DATA POPULATION ***
            document.querySelector('.neon-btn').style.borderColor = color;
            document.querySelector('.neon-btn').style.color = color;
            
            // 1. Sutra Link
            document.getElementById('deep-sutra-desc').innerText = oracle.deep_sutra_desc;
            document.getElementById('link-sutra').href = `https://www.google.com/search?q=${encodeURIComponent(oracle.deep_sutra_key + " pdf or full text")}`;
            
            // 2. Steps
            const stepsList = document.getElementById('deep-steps');
            stepsList.innerHTML = '';
            oracle.deep_steps.forEach((step, index) => {
                let li = document.createElement('li');
                li.innerHTML = `<strong>STEP ${index+1}.</strong> ${step}`;
                stepsList.appendChild(li);
            });

            // 3. Audio Link
            const audioQuery = encodeURIComponent(oracle.deep_audio_key);
            document.getElementById('link-youtube').href = `https://www.youtube.com/results?search_query=${audioQuery}`;
            document.getElementById('link-spotify').href = `https://open.spotify.com/search/${audioQuery}`;

            // Show Button
            deepTrigger.style.display = 'block';
        }
    }
</script>
</body>
</html>
